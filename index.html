<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Inventory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 16px;
            padding-bottom: 80px;
        }
        
        .app {
            max-width: 600px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .nav {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: #f5f5f5;
            padding: 8px 0;
            z-index: 10;
        }
        
        .nav button {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .nav button.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .form-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
            flex: 1;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .item-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }
        
        .item-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }
        
        .btn-edit {
            background: #ffc107;
            color: #333;
        }
        
        .btn-delete {
            background: #dc3545;
            color: white;
        }
        
        .item-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 14px;
            color: #666;
        }
        
        .detail-label {
            font-weight: 600;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #007bff;
            color: white;
            font-size: 24px;
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Grocery Inventory</h1>
        
        <div class="nav">
            <button class="nav-btn active" data-view="inventory">Inventory</button>
            <button class="nav-btn" data-view="voice">Voice</button>
            <button class="nav-btn" data-view="shopping">Shopping</button>
            <button class="nav-btn" data-view="spending">Spending</button>
        </div>
        
        <div id="inventory-view" class="view">
            <div id="form-container" style="display: none;">
                <div class="form-card">
                    <h2 id="form-title">Add Item</h2>
                    <form id="item-form">
                        <div class="form-group">
                            <label>Barcode (optional)</label>
                            <div style="display: flex; gap: 8px;">
                                <input type="text" id="barcode" placeholder="Scan or type barcode">
                                <button type="button" class="btn-secondary" id="lookup-btn" style="white-space: nowrap;">Lookup</button>
                            </div>
                            <small style="color: #666; font-size: 12px;">Leave blank for items without barcodes</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Item Name</label>
                            <input type="text" id="name" required placeholder="e.g., Milk">
                        </div>
                        
                        <div class="form-group">
                            <label>Brand (optional)</label>
                            <input type="text" id="brand" placeholder="e.g., Organic Valley">
                        </div>
                        
                        <div class="form-group">
                            <label>Quantity</label>
                            <input type="number" step="0.01" id="quantity" required placeholder="e.g., 2">
                        </div>
                        
                        <div class="form-group">
                            <label>Unit</label>
                            <select id="unit" required>
                                <option value="">Select unit</option>
                                <option value="each">each</option>
                                <option value="lbs">lbs</option>
                                <option value="oz">oz</option>
                                <option value="gallons">gallons</option>
                                <option value="quarts">quarts</option>
                                <option value="pints">pints</option>
                                <option value="cups">cups</option>
                                <option value="liters">liters</option>
                                <option value="ml">ml</option>
                                <option value="boxes">boxes</option>
                                <option value="cans">cans</option>
                                <option value="jars">jars</option>
                                <option value="bottles">bottles</option>
                                <option value="bags">bags</option>
                                <option value="packages">packages</option>
                                <option value="bunches">bunches</option>
                                <option value="dozen">dozen</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Store</label>
                            <select id="store" required>
                                <option value="">Select store</option>
                                <option value="Goose Community Grocer">Goose Community Grocer</option>
                                <option value="Payless Foods">Payless Foods</option>
                                <option value="PCC">PCC</option>
                                <option value="Costco">Costco</option>
                                <option value="Clinton Market">Clinton Market</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Price ($)</label>
                            <input type="number" step="0.01" id="price" required placeholder="e.g., 6.25">
                        </div>
                        
                        <div class="form-group">
                            <label>Purchase Date</label>
                            <input type="date" id="purchaseDate" required>
                        </div>
                        
                        <div class="button-group">
                            <button type="submit" class="btn-primary">Add Item</button>
                            <button type="button" class="btn-secondary" id="cancel-btn">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div id="items-list"></div>
            
            <div id="empty-state" class="empty-state" style="display: none;">
                <p>No items yet. Tap the + button to add your first item.</p>
            </div>
        </div>
        
        <div id="voice-view" class="view" style="display: none;">
            <div class="form-card">
                <h2 style="margin-bottom: 12px;">Step 1: Copy this prompt</h2>
                <p style="color: #666; margin-bottom: 12px; font-size: 14px;">
                    Copy this prompt and paste it into any LLM (Claude, ChatGPT, etc.)
                </p>
                <textarea id="voice-prompt" readonly style="width: 100%; min-height: 200px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; font-size: 13px; margin-bottom: 12px; resize: vertical;">I need you to help me inventory my groceries. I'm going to speak/type a list of items I have. Please convert this into a JSON array with the following format:

[
  {
    "name": "item name",
    "brand": "brand name (or empty string if not mentioned)",
    "barcode": "",
    "quantity": number,
    "unit": "one of: each, lbs, oz, gallons, quarts, pints, cups, liters, ml, boxes, cans, jars, bottles, bags, packages, bunches, dozen",
    "store": "",
    "price": "",
    "purchaseDate": ""
  }
]

Rules:
- Leave store, price, and purchaseDate as empty strings - I'll fill those in later
- If I don't specify a unit, use your best judgment (e.g., "milk" = gallons, "eggs" = dozen, "apples" = each)
- If I say "a few" or "some", estimate a reasonable quantity
- Keep it simple - just parse what I say into clean JSON
- Return ONLY the JSON array, no other text

Here's my inventory:</textarea>
                <button class="btn-primary" onclick="copyPrompt()" style="width: 100%;">Copy Prompt</button>
            </div>
            
            <div class="form-card" style="margin-top: 20px;">
                <h2 style="margin-bottom: 12px;">Step 2: Paste the JSON response here</h2>
                <p style="color: #666; margin-bottom: 12px; font-size: 14px;">
                    After speaking your inventory to the LLM, copy its JSON response and paste it below
                </p>
                <textarea id="json-import" placeholder='[{"name": "Milk", "brand": "Organic Valley", ...}]' style="width: 100%; min-height: 150px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; font-size: 13px; margin-bottom: 12px; resize: vertical;"></textarea>
                <div class="button-group">
                    <button class="btn-primary" onclick="importJSON()">Import Items</button>
                    <button class="btn-secondary" onclick="clearImport()">Clear</button>
                </div>
                <div id="import-status" style="margin-top: 12px; padding: 12px; border-radius: 8px; display: none;"></div>
            </div>
        </div>
        
        <div id="shopping-view" class="view" style="display: none;">
            <div class="empty-state">
                <p>Shopping list view coming soon!</p>
            </div>
        </div>
        
        <div id="spending-view" class="view" style="display: none;">
            <div class="empty-state">
                <p>Spending tracking coming soon!</p>
            </div>
        </div>
        
        <button class="fab" id="add-btn">+</button>
    </div>
    
    <script>
        let items = [];
        let editingId = null;
        
        // Load items from localStorage
        function loadItems() {
            const saved = localStorage.getItem('groceryItems');
            if (saved) {
                items = JSON.parse(saved);
            }
            renderItems();
        }
        
        // Save items to localStorage
        function saveItems() {
            localStorage.setItem('groceryItems', JSON.stringify(items));
        }
        
        // Render items list
        function renderItems() {
            const listContainer = document.getElementById('items-list');
            const emptyState = document.getElementById('empty-state');
            
            if (items.length === 0) {
                listContainer.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                listContainer.innerHTML = items.map(item => `
                    <div class="item-card">
                        <div class="item-header">
                            <div>
                                <div class="item-name">${item.name}</div>
                                ${item.brand ? `<div style="color: #666; font-size: 14px;">${item.brand}</div>` : ''}
                            </div>
                            <div class="item-actions">
                                <button class="btn-small btn-edit" onclick="editItem(${item.id})">Edit</button>
                                <button class="btn-small btn-delete" onclick="deleteItem(${item.id})">Delete</button>
                            </div>
                        </div>
                        <div class="item-details">
                            <div><span class="detail-label">Quantity:</span> ${item.quantity} ${item.unit}</div>
                            <div><span class="detail-label">Store:</span> ${item.store}</div>
                            <div><span class="detail-label">Price:</span> $${parseFloat(item.price).toFixed(2)}</div>
                            <div><span class="detail-label">Date:</span> ${new Date(item.purchaseDate).toLocaleDateString()}</div>
                            ${item.barcode ? `<div style="grid-column: 1 / -1;"><span class="detail-label">Barcode:</span> ${item.barcode}</div>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }
        
        // Show form
        function showForm() {
            const formContainer = document.getElementById('form-container');
            formContainer.style.display = 'block';
            document.getElementById('purchaseDate').valueAsDate = new Date();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Hide form
        function hideForm() {
            document.getElementById('form-container').style.display = 'none';
            document.getElementById('item-form').reset();
            document.getElementById('form-title').textContent = 'Add Item';
            const submitBtn = document.querySelector('#item-form .btn-primary');
            if (submitBtn) {
                submitBtn.textContent = 'Add Item';
            }
            editingId = null;
        }
        
        // Edit item
        function editItem(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                editingId = id;
                document.getElementById('name').value = item.name;
                document.getElementById('brand').value = item.brand || '';
                document.getElementById('barcode').value = item.barcode || '';
                document.getElementById('quantity').value = item.quantity;
                document.getElementById('unit').value = item.unit;
                document.getElementById('store').value = item.store;
                document.getElementById('price').value = item.price;
                document.getElementById('purchaseDate').value = item.purchaseDate;
                document.getElementById('form-title').textContent = 'Edit Item';
                const submitBtn = document.querySelector('#item-form .btn-primary');
                if (submitBtn) {
                    submitBtn.textContent = 'Update Item';
                }
                showForm();
            }
        }
        
        // Delete item
        function deleteItem(id) {
            if (confirm('Delete this item?')) {
                items = items.filter(i => i.id !== id);
                saveItems();
                renderItems();
            }
        }
        
        // Handle form submit
        const form = document.getElementById('item-form');
        const submitBtn = form.querySelector('.btn-primary');
        
        function handleSubmit(e) {
            if (e) e.preventDefault();
            console.log('Form submitted!');
            
            const formData = {
                name: document.getElementById('name').value,
                brand: document.getElementById('brand').value,
                barcode: document.getElementById('barcode').value,
                quantity: document.getElementById('quantity').value,
                unit: document.getElementById('unit').value,
                store: document.getElementById('store').value,
                price: document.getElementById('price').value,
                purchaseDate: document.getElementById('purchaseDate').value
            };
            
            console.log('Form data:', formData);
            
            if (editingId) {
                // Update existing item
                const index = items.findIndex(i => i.id === editingId);
                items[index] = { ...formData, id: editingId };
            } else {
                // Add new item
                items.push({ ...formData, id: Date.now() });
            }
            
            saveItems();
            renderItems();
            hideForm();
        }
        
        form.addEventListener('submit', handleSubmit);
        submitBtn.addEventListener('click', (e) => {
            console.log('Button clicked!');
            if (form.checkValidity()) {
                handleSubmit(e);
            }
        });
        
        // Voice inventory functions
        function copyPrompt() {
            const promptText = document.getElementById('voice-prompt');
            promptText.select();
            document.execCommand('copy');
            
            // Visual feedback
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }
        
        function importJSON() {
            const jsonText = document.getElementById('json-import').value.trim();
            const statusDiv = document.getElementById('import-status');
            
            if (!jsonText) {
                showImportStatus('Please paste JSON first', 'error');
                return;
            }
            
            try {
                const importedItems = JSON.parse(jsonText);
                
                if (!Array.isArray(importedItems)) {
                    showImportStatus('JSON must be an array of items', 'error');
                    return;
                }
                
                let successCount = 0;
                let errorCount = 0;
                
                importedItems.forEach(item => {
                    // Validate required fields
                    if (!item.name || !item.quantity || !item.unit) {
                        errorCount++;
                        return;
                    }
                    
                    // Add item with current date if not specified
                    const newItem = {
                        name: item.name,
                        brand: item.brand || '',
                        barcode: item.barcode || '',
                        quantity: item.quantity,
                        unit: item.unit,
                        store: item.store || '',
                        price: item.price || '',
                        purchaseDate: item.purchaseDate || new Date().toISOString().split('T')[0],
                        id: Date.now() + successCount // Ensure unique IDs
                    };
                    
                    items.push(newItem);
                    successCount++;
                });
                
                saveItems();
                renderItems();
                
                if (successCount > 0) {
                    showImportStatus(`Successfully imported ${successCount} item(s)${errorCount > 0 ? ` (${errorCount} skipped due to errors)` : ''}`, 'success');
                    document.getElementById('json-import').value = '';
                    
                    // Switch to inventory view after 2 seconds
                    setTimeout(() => {
                        document.querySelector('[data-view="inventory"]').click();
                    }, 2000);
                } else {
                    showImportStatus('No valid items found to import', 'error');
                }
                
            } catch (error) {
                console.error('Import error:', error);
                showImportStatus('Invalid JSON format. Please check and try again.', 'error');
            }
        }
        
        function clearImport() {
            document.getElementById('json-import').value = '';
            document.getElementById('import-status').style.display = 'none';
        }
        
        function showImportStatus(message, type) {
            const statusDiv = document.getElementById('import-status');
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            statusDiv.style.background = type === 'success' ? '#d4edda' : '#f8d7da';
            statusDiv.style.color = type === 'success' ? '#155724' : '#721c24';
            statusDiv.style.border = `1px solid ${type === 'success' ? '#c3e6cb' : '#f5c6cb'}`;
        }
        
        // Barcode lookup
        document.getElementById('lookup-btn').addEventListener('click', async () => {
            const barcode = document.getElementById('barcode').value.trim();
            if (!barcode) {
                alert('Please enter a barcode first');
                return;
            }
            
            const lookupBtn = document.getElementById('lookup-btn');
            lookupBtn.textContent = 'Loading...';
            lookupBtn.disabled = true;
            
            try {
                // Use the JSON endpoint with user agent
                const response = await fetch(`https://world.openfoodfacts.org/api/v0/product/${barcode}.json`, {
                    headers: {
                        'User-Agent': 'GroceryInventory/1.0'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                
                if (data.status === 1 && data.product) {
                    const product = data.product;
                    
                    // Auto-fill product name
                    if (product.product_name && !document.getElementById('name').value) {
                        document.getElementById('name').value = product.product_name;
                    }
                    
                    // Auto-fill brand
                    if (product.brands && !document.getElementById('brand').value) {
                        document.getElementById('brand').value = product.brands;
                    }
                    
                    // Try to suggest a unit based on quantity
                    if (product.quantity && !document.getElementById('unit').value) {
                        const qty = product.quantity.toLowerCase();
                        if (qty.includes('gal')) document.getElementById('unit').value = 'gallons';
                        else if (qty.includes('l') && !qty.includes('ml')) document.getElementById('unit').value = 'liters';
                        else if (qty.includes('oz')) document.getElementById('unit').value = 'oz';
                        else if (qty.includes('lb')) document.getElementById('unit').value = 'lbs';
                        else if (qty.includes('ml')) document.getElementById('unit').value = 'ml';
                        else document.getElementById('unit').value = 'each';
                    }
                    
                    alert('Product found! Fields updated.');
                } else {
                    alert('Product not found in database. Please enter details manually.');
                }
            } catch (error) {
                console.error('Lookup error:', error);
                alert('Could not connect to barcode database. Please enter details manually.');
            } finally {
                lookupBtn.textContent = 'Lookup';
                lookupBtn.disabled = false;
            }
        });
        
        // Cancel button
        document.getElementById('cancel-btn').addEventListener('click', hideForm);
        
        // Add button
        document.getElementById('add-btn').addEventListener('click', showForm);
        
        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const view = e.target.dataset.view;
                
                // Update active button
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                // Show correct view
                document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
                document.getElementById(`${view}-view`).style.display = 'block';
            });
        });
        
        // Set today's date as default and initialize
        document.getElementById('purchaseDate').valueAsDate = new Date();
        loadItems();
        
        console.log('Grocery inventory app initialized');
    </script>
</body>
</html>
